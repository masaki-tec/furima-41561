# =============================
# seeds.rb - 本番向け完全最適化版
# =============================

puts "===== seeds.rb を実行中 ====="

# ----------------------------
# 既存カテゴリをリセット
# ----------------------------
if ENV['FORCE_RESET_CATEGORIES'] == 'true'
  puts "⚠️ 本番環境も含め、既存カテゴリを全削除します..."
  Category.destroy_all
elsif Rails.env.development? || Rails.env.test?
  puts "既存カテゴリを全削除します..."
  Category.destroy_all
else
  puts "本番環境でリセットはスキップ。FORCE_RESET_CATEGORIES を true に設定すると削除されます。"
end

# ----------------------------
# 親カテゴリ
# ----------------------------
parent_categories = [
  "レディース", "メンズ", "インテリア・住まい・小物",
  "本・音楽・ゲーム", "おもちゃ・ホビー・グッズ", "コスメ・香水・美容",
  "家電・スマホ・カメラ", "スポーツ・レジャー", "ハンドメイド", "チケット",
  "自動車・オートバイ", "その他"
]

puts "親カテゴリを作成中..."
parent_categories.each do |name|
  Category.find_or_create_by!(name: name)
  puts "作成または存在確認: #{name}"
end

# ----------------------------
# 子カテゴリ・孫カテゴリ作成メソッド
# ----------------------------
def create_children(parent_category, children_hash)
  children_hash.each do |child_name, grandchildren|
    child = parent_category.children.find_or_create_by!(name: child_name)
    grandchildren.each do |grandchild_name|
      child.children.find_or_create_by!(name: grandchild_name)
    end
    puts "作成または存在確認: #{parent_category.name} > #{child_name} (#{grandchildren.count} 件)"
  end
end

# ============================
# レディースカテゴリ
# ============================
ladies_children = {
  "トップス" => ["Tシャツ/カットソー(半袖/袖なし)", "Tシャツ/カットソー(七分/長袖)", "シャツ/ブラウス(半袖/袖なし)", "シャツ/ブラウス(七分/長袖)", "ポロシャツ", "キャミソール", "タンクトップ", "ホルターネック", "ニット/セーター", "チュニック", "カーディガン/ボレロ", "アンサンブル", "ベスト/ジレ", "パーカー", "トレーナー/スウェット", "ベアトップ/チューブトップ", "その他"],
  "ジャケット/アウター" => ["テーラードジャケット", "ノーカラージャケット", "Gジャン/デニムジャケット", "レザージャケット", "ダウンジャケット", "ライダースジャケット", "ミリタリージャケット", "ダウンベスト", "ジャンパー/ブルゾン", "ポンチョ", "ロングコート", "トレンチコート", "ダッフルコート", "ピーコート", "チェスターコート", "モッズコート", "スタジャン", "毛皮/ファーコート", "スプリントコート", "スカジャン", "その他"],
  "パンツ" => ["デニム/ジーンズ", "ショートパンツ", "カジュアルパンツ", "ハーフパンツ", "チノパン", "ワークパンツ/カーゴパンツ", "クロップドパンツ", "サロペット/オーバーオール", "オールインワン", "サルエルパンツ", "ガウチョパンツ", "その他"],
  "スカート" => ["ミニスカート", "ひざ丈スカート", "ロングスカート", "キュロット", "その他"],
  "ワンピース" => ["ミニワンピース", "ひざ丈ワンピース", "ロングワンピース", "その他"],
  "靴" => ["ハイヒール/パンプス", "ブーツ", "サンダル", "スニーカー", "ミュール", "モカシン", "ローファー/革靴", "フラットシューズ/バレエシューズ", "長靴/レインシューズ", "その他"],
  "ルームウェア/パジャマ" => ["パジャマ", "ルームウェア", "その他"],
  "バッグ" => ["ハンドバッグ", "トートバッグ", "エコバッグ", "リュック/バックパック", "ボストンバッグ", "スポーツバッグ", "ショルダーバッグ", "クラッチバッグ", "ポーチ/バニティ", "ボディバッグ/ウェストバッグ", "その他"],
  "その他" => ["その他"]
}

create_children(Category.find_by!(name: "レディース"), ladies_children)

# ============================
# メンズカテゴリ
# ============================
mens_children = {
  "トップス" => ["Tシャツ", "ポロシャツ", "シャツ", "タンクトップ", "ニット/セーター", "パーカー", "カーディガン", "トレーナー/スウェット", "ジャージ", "ベスト", "その他"],
  "ジャケット/アウター" => ["テーラードジャケット", "Gジャン/デニムジャケット", "レザージャケット", "ダウンジャケット", "ライダースジャケット", "ミリタリージャケット", "ダウンベスト", "ジャンパー/ブルゾン", "モッズコート", "チェスターコート", "ピーコート", "スタジャン", "スプリントコート", "スカジャン", "その他"],
  "パンツ" => ["デニム/ジーンズ", "カジュアルパンツ", "スラックス", "チノパン", "ショートパンツ", "ワークパンツ/カーゴパンツ", "オールインワン", "サルエルパンツ", "その他"],
  "靴" => ["スニーカー", "サンダル", "ブーツ", "モカシン", "ローファー", "ビジネスシューズ", "長靴/レインシューズ", "その他"],
  "バッグ" => ["トートバッグ", "リュック/バックパック", "ボストンバッグ", "スポーツバッグ", "ショルダーバッグ", "クラッチバッグ", "ボディバッグ/ウェストバッグ", "その他"],
  "帽子" => ["キャップ", "ハット", "ニットキャップ", "ハンチング/ベレー帽", "その他"],
  "アクセサリー" => ["ネックレス", "ブレスレット", "バングル", "リング", "ピアス", "ウォレットチェーン", "その他"],
  "スーツ" => ["スーツジャケット", "スラックス", "ベスト", "その他"],
  "水着" => ["トランクス", "ボクサーパンツ", "その他"]
}

create_children(Category.find_by!(name: "メンズ"), mens_children)

# ============================
# 本・音楽・ゲームカテゴリ
# ============================
books_music_games_children = {
  "本" => ["文学/小説", "人文/社会", "ノンフィクション/教養", "地図/旅行ガイド", "趣味/スポーツ/実用", "資格/検定", "絵本/児童書", "参考書", "その他"],
  "漫画" => ["少年漫画", "少女漫画", "青年漫画", "女性漫画", "同人誌", "その他"],
  "雑誌" => ["ファッション", "趣味/実用", "マンガ雑誌", "その他"],
  "CD" => ["邦楽", "洋楽", "アニメ", "クラシック", "K-POP/韓流", "その他"],
  "DVD/ブルーレイ" => ["映画", "アニメ", "テレビドラマ", "お笑い/バラエティ", "その他"],
  "レコード" => ["邦楽", "洋楽", "その他"],
  "ゲーム" => ["家庭用ゲーム", "携帯用ゲーム", "PCゲーム", "その他"]
}

create_children(Category.find_by!(name: "本・音楽・ゲーム"), books_music_games_children)

# ============================
# 家電・スマホ・カメラカテゴリ
# ============================
electronics_children = {
  "スマートフォン/携帯電話" => ["スマートフォン本体", "携帯電話本体", "アクセサリー"],
  "スマホアクセサリー" => ["ケース/カバー", "フィルム", "充電器", "イヤホン/ヘッドホン", "その他"],
  "パソコン/周辺機器" => ["ノートPC", "デスクトップPC", "ディスプレイ", "キーボード/マウス", "プリンター", "その他"],
  "カメラ" => ["デジタルカメラ", "一眼レフ", "ミラーレス", "交換レンズ", "フィルムカメラ", "三脚/アクセサリー", "その他"],
  "テレビ/映像機器" => ["テレビ", "プロジェクター", "ブルーレイ/DVDプレイヤー", "録画用機器", "その他"],
  "オーディオ機器" => ["アンプ", "スピーカー", "ヘッドホン", "レコーダー", "その他"],
  "生活家電" => ["冷蔵庫", "洗濯機", "電子レンジ", "掃除機", "炊飯器", "エアコン", "その他"],
  "美容/健康家電" => ["ドライヤー", "ヘアアイロン", "美顔器", "マッサージ器", "体重計", "その他"],
  "その他" => []
}

create_children(Category.find_by!(name: "家電・スマホ・カメラ"), electronics_children)

# ============================
# インテリア・住まい・小物カテゴリ
# ============================
interior_children = {
  "キッチン/食器" => ["食器", "カトラリー", "調理器具", "キッチン収納", "その他"],
  "ベッド/マットレス" => ["ベッドフレーム", "マットレス", "寝具セット", "枕", "その他"],
  "ソファ/ソファベッド" => ["ソファ", "ソファベッド", "座椅子", "クッション", "その他"],
  "椅子/チェア" => ["ダイニングチェア", "オフィスチェア", "スツール", "その他"],
  "机/テーブル" => ["ダイニングテーブル", "デスク", "サイドテーブル", "折りたたみテーブル", "その他"],
  "収納家具" => ["本棚/ラック", "キャビネット", "クローゼット", "チェスト", "その他"],
  "照明" => ["シーリングライト", "ペンダントライト", "スタンドライト", "その他"],
  "インテリア小物" => ["置物", "時計", "花瓶", "アート/ポスター", "その他"],
  "季節/空調/加湿器" => ["扇風機", "ヒーター", "加湿器", "空気清浄機", "その他"],
  "その他" => []
}

create_children(Category.find_by!(name: "インテリア・住まい・小物"), interior_children)

puts "✅ カテゴリ作成が完了しました！"